<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Slickr: A Flickr API implementation.</title>
    <link type="text/css" rel="stylesheet" href="./Slickr.css" />
</head>
<body>
    <div id="control-panel">
        <span id="site-title">Slickr</span>
        <button id="reloadBtn" value="reload">reload</button>
    </div>
    <div id="slick-images"></div>
    <div id="scripts">
        <script>
            var imageProperties = {
                height: 120,
                containerId: 'slick-images'
            };
            window.EXEC_ENV = 'DEV';
            function log(functionName, paramList) {
                if(window.EXEC_ENV === 'DEV'){
                    var paramString = paramList.map(function (item){
                        if(typeof item === typeof ''){
                            return item;
                        } else {
                            return JSON.stringify(item);
                        }
                    }).join(' ');
                    console.log(functionName, 'called with', paramString);
                }
            }
            function appendImageToContainer(slickImage) {
                log('appendImageToContainer', [ 'slickImage', slickImage ]);
                var container = document.getElementById(imageProperties.containerId);
                container.appendChild(slickImage);
            }
            function createAnchor(url) {
                log('createAnchor', [ 'url', url ]);
                var anchor = document.createElement('a');
                anchor.href = url;
                return anchor;
            }
            function createImage(url, title) {
                log('createImage', [ 'url', url, 'title', title ]);
                var image = document.createElement('img');
                image.src = url;
                image.title = title;
                image.height = imageProperties.height;
                return image;
            }
            function appendImageToAnchor(image, anchor) {
                log('appendImageToAnchor', [ 'image', image, 'anchor', anchor ]);
                anchor.appendChild(image);
                return anchor;
            }
            function makePhotoUrl(photo){
                log('makePhotoUrl',[ 'photo', photo ]);
                return "http://farm" + photo.farm + ".static.flickr.com/" +
                    photo.server + "/" + photo.id + "_" + photo.secret + "_" + "t.jpg";
            }
            function makeLinkUrl(photo){
                log('makeLinkUrl',[ 'photo', photo ]);
                return "http://www.flickr.com/photos/" + photo.owner + "/" + photo.id;
            }
            function onResponseFromFlickrApi(res){
                log('onResponseFromFlickrApi', [ 'res', res ]);
                var photos = [];
                for (var i = 0, len = res.photos.photo.length; i < len; i++) {
                    photo = res.photos.photo[i];
                    photoSrcUrl = makePhotoUrl(photo);
                    anchorHrefUrl = makeLinkUrl(photo);
                    var anchor = createAnchor(anchorHrefUrl);
                    var image = createImage(photoSrcUrl);
                    var anchoredImage = appendImageToAnchor(image, anchor);
                    appendImageToContainer(anchoredImage);
                    photos.push(anchoredImage);
                }
                return photos;
            }
            function jsonFlickrApi(res){
                log('jsonFlickrApi', [ 'res', res ]);
                onResponseFromFlickrApi(res);
            }
        </script>
        <script src="https://api.flickr.com/services/rest/?method=flickr.photos.getRecent&api_key=84bf9b29bce8db001d1e58dbec8a5770&per_page=10&page=1&format=json"></script>
    </div>
</body>
</html>
